# 수집 아키텍처

## 수집 요구사항
- 요구사항 1 : 차량의 다양한 장치로부터 발생하는 로그 파일을 수집해서 기능별 상태를 점검한다.
- 요구사항 2 : 운전자의 운행 정보가 담긴 로그를 실시간으로 수집해서 주행 패턴을 분석한다.

![Cap 2021-07-18 20-49-48-009](https://user-images.githubusercontent.com/76901290/126065901-b0016fc3-b214-4287-bbc6-9b8f540f2c68.png)

- 2번 추가 설명

            
      로그 파일의 유형은 두 가지가 있다. 첫번재는 일단위로 발생하는 배치 로그 두번째는 실시간으로 발생하는 리얼 타임 로그가 있다.
      배치 로그는 100대의 스마트카에서 로그 파일이 쌓이고 쌓여서 하루가 되면 1일치의 로그 파일들을 빅데이터에 저장해야한다.
      즉 파일 이벤트가 하루가 다되면 이를 감지해서 빅데이터에 전송할 수 있는 플럼의 기능이 있어야 한다.


- 4번 추가 설명

      
      플럼의 인터셉터는 특정한 데이터들을 훅킹해서 가공을 하고 클렌징을 할 수 있는 기능
      플럼의 인터셉터 기능을 이용해서 가비지 데이터를 정리


- 5번 추가 설명

      
      Channel에서 1차적으로 버퍼 역할을 해주고 아키텍처 관점에서 카프카 Broker가 장애를 대비하고
      버퍼 역할도 해주는 로컬 디스크에 임시 저장하는 기능도 가지고 있음 


![Cap 2021-07-18 21-00-29-272](https://user-images.githubusercontent.com/76901290/126066206-cda543d7-b276-4db0-913f-9336968ebe38.jpg)



      스마트카 로그 시물레이션이 스마트카 100대를 시뮬레이션 해준다. 이때 스마트카에서 발생하는 로그 유형이 크게 두가지로 나뉜다.
      1초 간격으로 발생하는 운전자의 실시간 이벤트 로그, 그리고 3초 간격으로 발생하지만 이를 하루 단위로 모아두었다가 처리하는 배치 로그 이 두가지가 있다.
      먼저 실시간 로그는 일초에 400KB 운전자 운행 정보이고 이를 실시간으로 플럼이 수집을 한다. ExecTail Source를 통해 수집을 한다.
      배치 로그 같은 경우에는 하루가 되면 배치 파일이 하나가 생기는데 이 배치 파일을 이벤트를 SpoonDir Source를 통해서 플럼이 수집을 한다.
      
      스마트카 로그 시뮬레이터에서 발생되는 크게 두개의 유형의 빠른 스피드 데이터와 볼륨이 있는 배치 파일들을 플럼 에이전트 1과
      플럼 에이전트 2로 처리하는 아키텍처 방식 이때 사용되는 Source, Sink들이 Source와 Target 유형에 따라 다른것을 인지해야한다.


### 출처

"15일간의 빅데이터 파일럿 프로젝트",인프런,https://www.inflearn.com/course/%EB%B9%85%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%8C%8C%EC%9D%BC%EB%9F%BF-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/dashboard
